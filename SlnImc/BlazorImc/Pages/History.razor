@page "/history"
@inject Blazored.LocalStorage.ILocalStorageService localStorage

<PageTitle>Histórico</PageTitle>

<div id="history">
    <div class="header-top container-fluid flex flex-colum p-1">
        <div class="center logo-imc">
            <img src="assets/icon-no-bg.png" alt="Ícone IMC" />
        </div>

        <div class="header-top center py-1">
            <h1>Histórico</h1>
        </div>

        <div class="mb-1">
            <EditForm Model="ModelFiltro">
                <InputText class="form-control" @bind-Value="ModelFiltro.Filtro" @oninput="FiltrarHistorico"></InputText>
            </EditForm>

        </div>

        <div class="box-blocos mt-2">

            @foreach (var historico in ListHistoricosFiltrados)
             {
                if (historico.PesoIdeal)
                { 
                    <div class="py-1 bloco-item flex">
                        <div class="bloco-q"></div>
                        <div class="pl-1 width100">
                            <div class="flex justify-between mb-05">
                                <h4 class="flex">Peso ideal <span class="icon-peso icon-peso-verde">&#10003;</span></h4>
                                <span class="tempo">8m atrás</span>
                            </div>
                            <div>
                                <p>
                                    Parabéns, você está no seu peso ideal,
                                    continue mantendo este estilo!
                                </p>
                            </div>
                        </div>
                    </div>
                }
                else
                { 
                    <div class="py-1 bloco-item flex">
                        <div class="bloco-q"></div>
                        <div class="pl-1 width100">
                            <div class="flex justify-between mb-05">
                                <h4 class="flex">Sobrepeso <span class="icon-peso icon-peso-vermelho">&minus;</span></h4>
                                <span class="data">12/10/2023</span>
                            </div>
                            <div>
                                <p>Estamos quase lá! Faça alguns ajustes para ficar no peso ideal</p>
                            </div>
                        </div>
                    </div>
                 }
            } 
        </div>

    </div>
</div>


@code {
    const string key = "keyHist";
    public FiltroHistorico ModelFiltro = new();

    public Historico Model { get; set; } = new();
    public List<Historico> ListHistoricos = new();
    public List<Historico> ListHistoricosFiltrados = new();

    protected override async Task OnInitializedAsync()
    {
        ListHistoricos = await localStorage.GetItemAsync<List<Historico>>(key);
        FiltrarHistorico();
    }

    public void FiltrarHistorico()
    {
        ListHistoricosFiltrados = ListHistoricos;
        if (!string.IsNullOrEmpty(ModelFiltro.Filtro.Trim()))
        {
            ListHistoricosFiltrados = ListHistoricos
            .Where(historico => historico.TextoResultado
            .ToLower()
            .Contains(ModelFiltro.Filtro.ToLower()))
            .ToList();

            var teste = ModelFiltro.Filtro;
            
        }
    }
}